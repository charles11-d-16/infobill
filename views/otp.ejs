<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/js/sidebarToggle.js"></script>
  <title>Enter OTP - OsLAMIB</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f9fafe;
      position: relative;
    }
    body::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #ffffff 0%, #e6f7ff 100%);
      z-index: -1;
    }
    .container {
      display: flex;
      width: 90%;
      max-width: 800px;
      border-radius: 16px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 12px 40px rgba(0,0,0,0.08);
      min-height: 340px;
    }
    .left-side {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 30px;
      text-align: center;
      background: #fff;
    }
    .right-side {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      background: #f0f8ff;
    }
    .error-message {
      background: #fee;
      color: #c33;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 16px;
      border: 1px solid #fcc;
      width: 100%;
      text-align: center;
    }
    .otp-btn {
      width: 100%;
      padding: 12px;
      font-size: 15px;
      font-weight: 600;
      color: white;
      background: #0891b2;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1px;
    }
    .otp-btn:hover { background: #0e7490; }
    .otp-btn:active { transform: translateY(1px); }
    @media (max-width: 700px) {
      .container { flex-direction: column; min-height: unset; }
      .right-side { padding: 20px; }
      .left-side { padding: 24px 12px; }
      .right-side img { max-width: 100%; }
    }

     #sidebar-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4); /* Dark semi-transparent color */
      z-index: 999; /* Below the sidebar (1000) but above everything else */
      display: none; /* Hidden by default */
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    /* REPLACE YOUR OLD MEDIA QUERY WITH THIS */
  /* REPLACE YOUR OLD MEDIA QUERY WITH THIS */
    @media (max-width: 900px) {
      /* Hides the preview card on mobile to save space */
      .preview-card {
        display: none;
      }

      /* Makes the main container and form fill the screen */
      .main-container {
        margin-left: 0 !important; /* Overrides JS style */
        padding: 0;
        height: auto;
        margin-top: 0;
      }
      .content-card {
        width: 100%;
        box-shadow: none;
        border-radius: 0;
        padding: 20px 25px;
        border-left: none;
        height: auto;
      }

      /* Converts sidebar to an off-canvas menu */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 1000;
        transition: transform 0.3s ease;
        /* The border-left from the original is now on the right */
        border-left: none;
        border-right: 4px solid #0891b2;
      }
      
      /* This class will be added by JS to hide the sidebar */
      .sidebar.is-hidden {
        transform: translateX(-100%);
      }

      /* --- REMOVED THE PROBLEMATIC #sidebar-backdrop rule here --- */
      
      .form-grid { grid-template-columns: 1fr !important; }
      .actions { text-align: center; }
    }
  </style>
</head>
<body>
  <div class="container" id="otpContainer" style="opacity:0;">
    <div class="left-side">
      <h1 style="font-size:28px;color:#0e7490;font-weight:700;margin-bottom:16px;">Two-Factor Authentication</h1>
      <p style="font-size:16px;color:#555;line-height:1.6;margin-bottom:24px;">Enter the 6-digit code sent to your email</p>
      <form method="POST" action="/verify-otp" style="width:100%;max-width:260px;margin:auto;">
        <input type="hidden" name="username" value="<%= username %>">
        <div class="input-wrapper" style="display:flex;justify-content:center;gap:16px;max-width:320px;width:100%;margin:0 auto 18px auto;background:#fff;padding:18px 18px;border-radius:10px;">
          <% for (let i = 0; i < 6; i++) { %>
            <input type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" class="otp-digit" id="otp<%= i %>" required style="width:44px;height:48px;text-align:center;font-size:22px;font-weight:600;border:2px solid #cfd8dc;border-radius:8px;background:#fff;color:#222;box-shadow:0 1px 4px rgba(0,0,0,0.04);outline:none;" autocomplete="one-time-code">
          <% } %>
          <input type="hidden" id="otp" name="otp" required>
        </div>
        <% if (typeof error !== 'undefined' && error) { %>
          <div class="error-message"><%= error %></div>
        <% } %>
  <button type="submit" class="otp-btn" style="display:block;width:320px;max-width:100%;margin:0 auto 0 auto;padding:14px;font-size:17px;font-weight:600;color:white;background:#0891b2;border:none;border-radius:8px;cursor:pointer;align-items:center;justify-content:center;gap:8px;">Verify <i class="bi bi-shield-lock"></i></button>
      </form>
    </div>
    <div class="right-side">
      <img src="/otp.png" alt="OTP" style="width:100%;max-width:340px;border-radius:16px;object-fit:cover;">
    </div>
  </div>
  <div id="splashScreen" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:99999;display:none;align-items:center;justify-content:center;">
    <video id="splashVideo" src="/exit.mp4" autoplay muted style="width:100vw;height:100vh;object-fit:cover;"></video>
  </div>
  <style>
    .fade-in {
      animation: fadeInOtp 1s ease forwards;
    }
    @keyframes fadeInOtp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
  <script>
    // OTP input auto-advance and combine
    const digitInputs = Array.from(document.querySelectorAll('.otp-digit'));
    const hiddenOtp = document.getElementById('otp');
    digitInputs.forEach((input, idx) => {
      input.addEventListener('input', function(e) {
        if (this.value.length === 1 && idx < 5) {
          digitInputs[idx + 1].focus();
        }
        updateOtpValue();
      });
      input.addEventListener('keydown', function(e) {
        if (e.key === 'Backspace' && this.value === '' && idx > 0) {
          digitInputs[idx - 1].focus();
        }
      });
    });
    function updateOtpValue() {
      hiddenOtp.value = digitInputs.map(i => i.value).join('');
    }
    // On form submit, ensure all digits are filled
    document.querySelector('form').addEventListener('submit', function(e) {
      updateOtpValue();
      if (hiddenOtp.value.length !== 6) {
        e.preventDefault();
        digitInputs.forEach(i => { if (!i.value) i.style.borderColor = '#f44336'; });
        return false;
      }
    });

    // Fade-in OTP form after splash
    document.addEventListener('DOMContentLoaded', function() {
      var splashScreen = document.getElementById('splashScreen');
      var splashVideo = document.getElementById('splashVideo');
      var otpContainer = document.getElementById('otpContainer');
      function showOtpWithFade() {
        splashScreen.style.display = 'none';
        otpContainer.classList.add('fade-in');
        otpContainer.style.opacity = '1';
      }
      if (splashScreen && splashVideo && otpContainer) {
        splashVideo.onended = showOtpWithFade;
        splashVideo.onerror = function() {
          setTimeout(showOtpWithFade, 5000);
        };
        if (splashScreen.style.display === 'flex') {
          // If splash is already showing, wait for video
        } else {
          // If splash is not showing, show OTP immediately
          showOtpWithFade();
        }
      } else {
        // Fallback: show OTP immediately
        if (otpContainer) {
          otpContainer.style.opacity = '1';
        }
      }
    });
  </script>
</body>
</html>
